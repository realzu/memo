# ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ (Execution Context)

## JS ì—”ì§„ì˜ ì½”ë“œ ì‹¤í–‰ ê³¼ì •

> ì†ŒìŠ¤ì½”ë“œì˜ "í‰ê°€" -> "ì‹¤í–‰" ê³¼ì •

1. í‰ê°€ ê³¼ì •
  - ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
  - ì„ ì–¸ë¬¸ë§Œ ì‹¤í–‰í•˜ì—¬ *í™˜ê²½ ë ˆì½”ë“œ*ì— ì‹ë³„ìë¥¼ keyë¡œ ë“±ë¡
    - í™˜ê²½ ë ˆì½”ë“œ(Environment Record): ì‹ë³„ìì™€ ì‹ë³„ìì— ë°”ì¸ë”©ëœ ê°’ì„ ê¸°ë¡ => ğŸ””í˜¸ì´ìŠ¤íŒ…
  - `{ x: undefined }`

2. ì‹¤í–‰ ê³¼ì •
  - ì„ ì–¸ë¬¸ ì´ì™¸ì˜ ì½”ë“œ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
  - í™˜ê²½ ë ˆì½”ë“œ ì°¸ì¡° ë˜ëŠ” ì—…ë°ì´íŠ¸(ê°’ í• ë‹¹ì‹œ)

- ì½”ë“œ ì „ì²´ ìˆœì„œ
  - ì „ì—­ ì½”ë“œ í‰ê°€(ì„ ì–¸ë¬¸ë§Œ-ë³€ìˆ˜/í•¨ìˆ˜)
    - ì½œ ìŠ¤íƒì— ì „ì—­ ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ ìƒì„±í•˜ë©°, ì´ ì•ˆì— ìˆëŠ” í™˜ê²½ ë ˆì½”ë“œì— ì„ ì–¸ë¬¸ ê¸°ë¡
      - varëŠ” undefinedë¡œ ê¸°ë¡
      - ì „ì—­ ìŠ¤ì½”í”„ì— ë“±ë¡
  - ì „ì—­ ì½”ë“œ ì‹¤í–‰
    - í‰ê°€ ê³¼ì •ì´ ëë‚¬ìœ¼ë‹ˆ ëŸ°íƒ€ì„ ì‹œì‘ë˜ì–´ ìˆœì°¨ì ìœ¼ë¡œ ì½”ë“œ ì‹¤í–‰
    - ê°’ í• ë‹¹ ë˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
    - í•¨ìˆ˜ í˜¸ì¶œì‹œ, ì „ì—­ì½”ë“œì˜ ì‹¤í–‰ì„ ì¼ì‹œì¤‘ë‹¨í•˜ê³  ì½”ë“œì˜ ì‹¤í–‰ìˆœì„œë¥¼ ë³€ê²½í•˜ì—¬ í•´ë‹¹ í•¨ìˆ˜ ë‚´ë¶€ë¡œ ì§„ì…
  - í•¨ìˆ˜ ì½”ë“œ í‰ê°€
    - ë§¤ê°œë³€ìˆ˜ ë° ì§€ì—­ë³€ìˆ˜ ì„ ì–¸ë¬¸ ì‹¤í–‰ => ì§€ì—­ìŠ¤ì½”í”„ì— ë“±ë¡
  - í•¨ìˆ˜ ì½”ë“œ ì‹¤í–‰
    - ëŸ°íƒ€ì„ ì‹œì‘
    - ì‹ë³„ì ì—†ìœ¼ë©´ ìŠ¤ì½”í”„ ì²´ì¸ì„ í†µí•´ ì‹ë³„ì ê²€ìƒ‰
    - í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ëŠ” ì‚¬ë¼ì§

## ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸

> ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë°ì— í•„ìš”í•œ í™˜ê²½ ì œê³µ ë° ì½”ë“œì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ê´€ë¦¬í•˜ëŠ” ì˜ì—­

`í™˜ê²½`: ì½”ë“œ ì‹¤í–‰ì— ì˜í–¥ì„ ì£¼ëŠ” ì¡°ê±´ì´ë‚˜ ìƒíƒœ (ex. ë³€ìˆ˜, í•¨ìˆ˜, ìŠ¤ì½”í”„, this..)  
so, í•„ìš”í•œ ì •ë³´ë¥¼ í•œ ê³³ì— ëª¨ì•„ ì œê³µí•˜ëŠ” ê°ì²´

LexicalEnvironmentì™€ VariableEnvironmentë¡œ êµ¬ì„±

- LexicalEnvironment
  - ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì—ì„œ í™˜ê²½ ë ˆì½”ë“œ(`Environment Record`) ë° ì™¸ë¶€ í™˜ê²½ ì°¸ì¡°(`Outer Environment Reference`) ì˜ì—­ì„ ê°€ë¦¬í‚´

### ì½œ ìŠ¤íƒ

> í˜„ì¬ ì‹¤í–‰ë˜ê³ ìˆëŠ” ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•œ êµ¬ì¡°

ì½œ ìŠ¤íƒ (Call Stack, í˜¸ì¶œ ìŠ¤íƒ)  
ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€ Memory Heapê³¼ Call Stackì˜ êµ¬ì„±ìš”ì†Œë¡œ ì´ë£¨ì–´ì§  

- ì—¬ê¸°ì— ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ìŒ“ì„
- ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€ ì²˜ìŒì— ì „ì—­ ì½”ë“œ í‰ê°€ì‹œ ì „ì—­ ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ë¶€í„° ìƒì„±
- ì´í›„ ì½”ë“œ ì‹¤í–‰í•˜ë©° push(í•¨ìˆ˜ í˜¸ì¶œ) & pop(í•¨ìˆ˜ ì¢…ë£Œ)
- ê°€ì¥ ìµœìƒìœ„ì— ìˆëŠ” ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ê°€ í™œì„±í™”ë˜ì–´ìˆìŒ

### í˜¸ì´ìŠ¤íŒ…

**í™˜ê²½ ë ˆì½”ë“œ**ì— ì˜í•œ í˜¸ì´ìŠ¤íŒ… í˜„ìƒ
> ì„ ì–¸ë¬¸ì´ ë§ˆì¹˜ ìµœìƒë‹¨ì— ëŒì–´ì˜¬ë ¤ì§„ ë“¯í•œ í˜„ìƒ

- ë³€ìˆ˜ í˜¸ì´ìŠ¤íŒ…
  - let, const
    - ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ 'í‰ê°€' ê³¼ì •ì—ì„œ ì‹ë³„ìë¥¼ ê¸°ë¡í•˜ê¸´ í•˜ì§€ë§Œ ê°’ì„ ì´ˆê¸°í™”í•˜ì§€ëŠ” ì•ŠìŒ `{ y }`
    - ì„ ì–¸(o). ì´ˆê¸°í™”(x). ì„ ì–¸ê³¼ ë™ì‹œì— ê°’ í• ë‹¹ í•„ìš”
    - ë”°ë¼ì„œ, ì„ ì–¸ ë¼ì¸ ì´ì „ì—ëŠ” ì‹ë³„ì ì°¸ì¡° ë¶ˆê°€
      - *ì¼ì‹œì  ì‚¬ê°ì§€ëŒ€ (Temporal Dead Zone)*
      - ì„ ì–¸ ì´ì „ì— ì‹ë³„ìë¥¼ ì°¸ì¡°í•  ìˆ˜ ì—†ëŠ” êµ¬ì—­
  - var í‚¤ì›Œë“œ
    - ì„ ì–¸ê³¼ ì´ˆê¸°í™” ë™ì‹œì— ì´ë£¨ì–´ì ¸, ì‹ë³„ìì— ì•”ë¬µì ìœ¼ë¡œ `undefined` í• ë‹¹ (ê°’ ë°”ì¸ë”©)
    - cf. ì„ ì–¸: ë©”ëª¨ë¦¬ ê³µê°„ í™•ë³´ í›„ ë©”ëª¨ë¦¬ ì£¼ì†Œì— ì‹ë³„ì ì—°ê²°

- í•¨ìˆ˜ í˜¸ì´ìŠ¤íŒ…
  - í•¨ìˆ˜ í‘œí˜„ì‹
    - ë³€ìˆ˜ í˜¸ì´ìŠ¤íŒ…ê³¼ ë™ì¼í•˜ê²Œ ë™ì‘ (í•¨ìˆ˜ë¥¼ ë³€ìˆ˜ì— ë‹´ê³ ìˆì–´ì„œ)
    - í•¨ìˆ˜ ì„ ì–¸ ì´ì „ì— í˜¸ì¶œí•˜ë©´ ì—ëŸ¬
      - var: undefinedë¡œ ì´ˆê¸°í™”ë˜ëŠ”ë° í˜¸ì¶œí•˜ë‹ˆ Type error
      - let/const: ê°’ì´ ì´ˆê¸°í™”ë˜ì§€ì•Šì•„ ì°¸ì¡°í•˜ë©´ reference error
  - í•¨ìˆ˜ ì„ ì–¸ë¬¸
    - ì„ ì–¸ê³¼ ë™ì‹œì— í•¨ìˆ˜ ìƒì„±ë˜ì–´ í™˜ê²½ ë ˆì½”ë“œì— ê¸°ë¡
    - ì´ë¯¸ ì½”ë“œ ì‹¤í–‰ì‹œ, í‰ê°€ ë‹¨ê³„ì—ì„œ ê¸°ë¡í–ˆê¸°ì— ëŸ°íƒ€ì„ ì´í›„ ì„ ì–¸ ë¼ì¸ ì „ì—ë„ í˜¸ì¶œ ê°€ëŠ¥

```javascript
const foo = () => { }; // í•¨ìˆ˜ í‘œí˜„ì‹
function bao() { }; // í•¨ìˆ˜ ì„ ì–¸ë¬¸
```

## ìŠ¤ì½”í”„

> í˜„ì¬ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì‹ë³„ìë“¤ì˜ ë²”ìœ„

by. ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì˜ Outer Environment Reference (ì™¸ë¶€ í™˜ê²½ ì°¸ì¡°)  
-> ë°”ê¹¥ì˜ Lexical Environment ê°€ë¦¬í‚´  
í˜¸ì¶œì´ ì•„ë‹Œ, **ì •ì˜**ëœ ìˆœê°„ì— ê²°ì •

- Outer Environment Reference
  - í•¨ìˆ˜ í˜¸ì¶œì‹œ -> ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ ìƒˆë¡œ ìƒì„±
  - ì´ ë•Œ, ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€ ë°”ê¹¥ ë ‰ì‹œì»¬ í™˜ê²½ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆëŠ” outer ë§Œë“¤ì–´ ë‘  (like ì‚¬ë‹¤ë¦¬)
    - ì´ì „ ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ì˜ í™˜ê²½ë ˆì½”ë“œ ì°¸ì¡° -> ì „ì—­ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê¹Œì§€ ë„ë‹¬ ê°€ëŠ¥
  - So, ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì˜ ì‹ë³„ì íŒë‹¨ì‹œ í™œìš©
    - ì‹ë³„ìë¥¼ ì°¾ì„ ë•Œ í˜„ì¬ ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ì— ì—†ìœ¼ë©´ => outer(ì´ì „ ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸)ë¡œ ë„˜ì–´ê°€ì„œ ì°¾ì„ ìˆ˜ ìˆìŒ
      - => `ìŠ¤ì½”í”„ ì²´ì´ë‹`
    - ê·¸ë¦¬ê³  ì°¾ê²Œ ë˜ë©´, ê·¸ ìƒìœ„ì˜ í™˜ê²½ë ˆì½”ë“œì— ìˆëŠ” ê°’ê¹Œì§€ëŠ” ë„ë‹¬í•  í•„ìš”ê°€ ì—†ìŒ
      - => `ë³€ìˆ˜ ì„€ë„ì‰` 
  
- ë³€ìˆ˜ ì„€ë„ì‰ (Variable Shadowing. ë³€ìˆ˜ ì€ë‹‰í™”)
  - *ë™ì¼í•œ* ì‹ë³„ìë¡œ ì¸í•´, ìƒìœ„ ìŠ¤ì½”í”„ì— ì„ ì–¸ëœ ì‹ë³„ìì˜ ê°’ì´ ê°€ë ¤ì§€ëŠ” í˜„ìƒ

```javascript
let water = false; // ë³€ìˆ˜ ì„€ë„ì‰

function goTo2F() {
  let water = true;
  function goTo3F() {
    console.log(water); // ? (-> true)
  }
  goTo3F();
}

goTo2F();
```

- ìŠ¤ì½”í”„ ì²´ì¸
  - ì‹ë³„ìë¥¼ ê²°ì •í•  ë•Œ í™œìš©í•˜ëŠ” ìŠ¤ì½”í”„ë“¤ì˜ ì—°ê²°ë¦¬ìŠ¤íŠ¸
  - í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹ë³„ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´, ì´ì „ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¡œ ì´ë™í•´ ê²€ìƒ‰
  - 3ì¸µì— ì—†ìœ¼ë©´ 2ì¸µ -> ì—†ìœ¼ë©´ 1ì¸µìœ¼ë¡œ íƒ€ê³ íƒ€ê³  í™˜ê²½ë ˆì½”ë“œ ì°¸ì¡° ê°€ëŠ¥ => `ìŠ¤ì½”í”„ ì²´ì´ë‹`

: ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ëŠ” **ì‹ë³„ì ê²°ì •**ì„ ë”ìš± íš¨ìœ¨ì ìœ¼ë¡œ í•˜ê¸° ìœ„í•œ ìˆ˜ë‹¨  

ë¬¼ë¡ , ìƒìœ„ ì‹¤í–‰ì»¨í…ìŠ¤íŠ¸ë¡œ ìŠ¤ì½”í”„ ì²´ì´ë‹í•˜ê¸° ì „ì— Closureì— ì‹ë³„ìê°€ ìˆëŠ”ì§€ ë¨¼ì € íŒë‹¨ !!

## Closure (í´ë¡œì €)

> ìì‹ ì´ ìƒì„±ë  ë•Œì˜ í™˜ê²½(Lexical Environment)ì„ ê¸°ì–µí•˜ëŠ” í•¨ìˆ˜

ì´ë¯¸ ìƒëª…ì£¼ê¸°ê°€ ì¢…ë£Œëœ ì™¸ë¶€ í•¨ìˆ˜ì˜ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ë©´ì„œ, ì™¸ë¶€ í•¨ìˆ˜ë³´ë‹¤ ì˜¤ë˜ ìƒì¡´í•˜ëŠ” í•¨ìˆ˜  
ì´ëŸ¬í•œ ì¤‘ì²© í•¨ìˆ˜ë¥¼ 'í´ë¡œì € (Closure)'ë¼ê³  ë¶€ë¥¸ë‹¤.

í•¨ìˆ˜ê°€ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•  ë•Œ (= ì¤‘ì²© í•¨ìˆ˜), ë°˜í™˜ë˜ëŠ” í•¨ìˆ˜ëŠ” **ìì‹ ì„ ë‘˜ëŸ¬ì‹¼ ë©”ëª¨ë¦¬ í™˜ê²½**ì„ ê°€ì§€ê³  í•¨ê»˜ ë°˜í™˜  
í•¨ìˆ˜ê°€ í˜¸ì¶œì´ ë˜ì–´ì•¼ë§Œ ì ‘ê·¼ ê°€ëŠ¥ -> ì •ë³´ ì€ë‹‰ì— ìœ ìš©

```javascript
function outer() { // ì™¸ë¶€í•¨ìˆ˜
  var count = 0;
  function inner() { // ì¤‘ì²©í•¨ìˆ˜
    count += 1;
  }
  return inner;
}

var newFn = outer(); // outerëŠ” ìƒëª…ì£¼ê¸° ì¢…ë£Œ -> ì½œìŠ¤íƒì—ì„œ ì œê±°
newFn(); // 1 -- innerë§Œ returnëì§€ë§Œ innerê°€ ë°˜í™˜ë  ë•Œ count ì‹ë³„ìë¥¼ ê°€ì§€ê³  ë‚˜ì˜´
newFn(); // 2 -- ê·¸ë˜ì„œ outer í•¨ìˆ˜ì˜ ì§€ì—­ë³€ìˆ˜ì¸ countë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒ
```


